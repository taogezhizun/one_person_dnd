Metadata-Version: 2.4
Name: one-person-dnd
Version: 0.1.0
Summary: One person DND web app (LLM as DM)
Author: Jason Liang
License: MIT
Requires-Python: >=3.12
Description-Content-Type: text/markdown
License-File: LICENSE
Dynamic: license-file

# one_person_dnd

一个“一键 Python 启动 Web”的单人 DND 系统（LLM 充当 DM），支持多战役存档、世界设定（可浏览/可编辑）与剧情摘要的持久化。

## 环境要求

- Python **3.12**

## 安装

```bash
pip install -r requirements.txt
pip install -e .
```

## 一键启动（Web）

```bash
python -m one_person_dnd
```

启动后会在浏览器打开 `http://127.0.0.1:8000`。

如果你不希望自动打开浏览器：

```bash
python -m one_person_dnd --no-browser
```

更多参数：

```bash
python -m one_person_dnd --help
```

## 基本使用流程（MVP）

0. 配置文件在项目根目录：`api_config.ini`（已加入 `.gitignore`，避免误提交密钥；可参考 `api_config.example.ini`）。
1. 打开 `/saves` 新建或选择战役（Campaign）与会话（Session）。
2. 打开 `/setup` 配置 `base_url/api_key/model`，点击“测试连接”，保存。
3. 打开 `/memory/world` 用结构化模板录入世界设定（地点/NPC/组织/规则），建议填写标签（逗号分隔）。
4. 打开 `/game` 输入玩家行动；可在“标签”里填本回合相关标签以召回设定。

## 页面/模块说明

### 存档（/saves）
- **用途**：管理多战役（Campaign）与多会话（Session），并设置“当前进入的战役/会话”。\n- **行为**：切换后会写入 `api_config.ini` 的 `[app]`，后续 `/game`、`/memory/*` 都会基于当前选择工作。

### 配置（/setup）
- **用途**：配置大模型调用参数（`base_url/api_key/model/timeout_seconds`）。\n- **说明**：保存后写入 `api_config.ini` 的 `[llm]`。

### 世界设定（/memory/world）
- **用途**：浏览 WorldBible 条目列表。\n- **新建（/memory/world/new）**：提供结构化表单模板（地点/NPC/组织/规则），并可填写标签。\n- **检索方式**：在 `/game` 的“标签”中输入逗号分隔的标签，系统用这些标签去召回相关设定条目注入 prompt。

### 剧情摘要（/memory/story）
- **用途**：浏览 StoryJournal（当前版本先提供查看页面；自动摘要会在后续迭代加入）。

### 游戏（/game）
- **用途**：玩家输入 → 调用 LLM DM → 返回叙事与可选行动，并写入 `turn_logs`。\n- **体验**：请求期间会显示“DM 思考中…”加载态；DM 输出支持 Markdown 渲染。

## 配置文件说明（api_config.ini）

- **[server]**：Web 启动参数\n  - `host` / `port` / `open_browser`\n- **[llm]**：大模型参数\n  - `base_url` / `api_key` / `model` / `timeout_seconds`\n- **[app]**：当前存档选择\n  - `active_campaign_id` / `active_session_id`

## 数据文件位置
- **SQLite 数据库**：项目根目录 `./.one_person_dnd/one_person_dnd.sqlite3`
